#!/usr/bin/env python

from __future__ import absolute_import
from __future__ import division
from __future__ import print_function

import argparse
import os
import sys
import tensorflow as tf
from tfdsbd import SentenceBoundaryDetector


def main(argv):
    del argv

    file_name = FLAGS.src_file.name
    FLAGS.src_file.close()

    with open(file_name, 'rb') as src_file:
        document = src_file.read().decode('utf-8')

    sbd = SentenceBoundaryDetector(FLAGS.model_dir)
    sentences = sbd.detect([document])
    print('\n\n--------------------------------------------------------------------------------\n\n'.join(sentences[0]))


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Split text document into sentences')
    parser.add_argument(
        'model_dir',
        type=str,
        help='Exported tfdsbd model directory')
    parser.add_argument(
        'src_file',
        type=argparse.FileType('rb'),
        help='Input text file')

    FLAGS, unparsed = parser.parse_known_args()
    assert os.path.exists(FLAGS.model_dir) and os.path.isdir(FLAGS.model_dir)

    tf.logging.set_verbosity(tf.logging.INFO)
    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)
